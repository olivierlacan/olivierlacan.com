---
layout: post
title: "Rails link_to array options are dangerous"
date: 2015-10-26 11:02
location: "Orlando, Florida"
categories:
  - rails
  - ruby
  - development
draft: true
---

Let me get straight to it. Most people use the `link_to` helper in Rails with
the dynamically generated route helpers Rails provides:

```ruby
link_to 'Watch Video', admin_video_path(video)
```

Some people use an array as the second argument because they argue that [Rails
route helpers are brittle](http://blog.pivotal.io/labs/labs/rails-route-helpers-are-brittle).

It looks like this:

```ruby
link_to 'Watch Video', [:admin, video]
```

The supposed advantage here is that instead of relying on a method that is dynamically
generated by Rails — and therefore could change — we're instead asking the object.
When you pass an object, Rails internally resolves the path to the resource.

While I understand the urge to write more object-oriented code in Rails, this
ignores several potential issues with resource resolving:

1. There may not be a route to the resource
2. The resource-resolved path may not match the route
3. A `nil` resource will cause serious issues in path resolution

## There may not be a route to the resource

The following code:

```ruby
link_to 'Watch Video', [:admin, video]
```

Assumes that route are organized this way:

```ruby
# routes.rb
namespace :admin do
  resource :videos
end
```

Any change in this hierarchy (renamming the `admin` namespace for instance) would
have the same result as if you had used dynamic route helpers: breakage.

## The resource-resolved path may not match the route

In simple or new Rails applications, it's likely that RESTful resources will
be used most of the time. With root-level resources, using the resource itself
to generate the path makes sense. When resources are namespaced or nested, the
resource-oriented array argument to `link_to` have the exact same effect as using
dynamic route helpers: you're hardcoding the structure of your routes into the
calls to `link_to`.

Route alterations *will* break link helpers and redirection. That's okay. They
should.

I don't *love* having to look up the dynamic route helpers for nested routes either
but arguing that `link_to "Course Video", [:admin, @course, @video]` is less
brittle than `admin_course_video_path(@course, @video)` is silly at best, and gives
you a false sense of security at worst.

## A `nil` resource will cause serious issues in path resolution

Here's something that happened to me recently, and which prompted this post. On
a Rails 3.2 application I was using the following code in a view partial:

```ruby
link_to video.author, [:admin, video.author]
```



![Routing Error]({{ site.url }}/assets/rails_3_2_routing_error.png)
